{"version":3,"sources":["../../src/utils/imageUpload.js"],"names":["uploadDir","path","join","__dirname","mkdirp","sync","storeFS","stream","filename","id","uuid","v4","Promise","resolve","reject","on","error","truncated","fs","unlinkSync","pipe","createWriteStream"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMA,YAAYC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,kBAArB,CAAlB;;AAGA;AACAC,iBAAOC,IAAP,CAAYL,SAAZ;;AAEO,MAAMM,4BAAU,CAAC,EAAEC,MAAF,EAAUC,QAAV,EAAD,KAA0B;AAC/C,QAAMC,KAAKC,eAAKC,EAAL,EAAX;AACA,QAAMV,OAAQ,GAAED,SAAU,IAAGS,EAAG,IAAGD,QAAS,EAA5C;AACA,SAAO,IAAII,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KACjBP,OACGQ,EADH,CACM,OADN,EACeC,SAAS;AACpB,QAAIT,OAAOU,SAAX;AACE;AACAC,mBAAGC,UAAH,CAAclB,IAAd;AACFa,WAAOE,KAAP;AACD,GANH,EAOGI,IAPH,CAOQF,aAAGG,iBAAH,CAAqBpB,IAArB,CAPR,EAQGc,EARH,CAQM,OARN,EAQeC,SAASF,OAAOE,KAAP,CARxB,EASGD,EATH,CASM,QATN,EASgB,MAAMF,QAAQ,EAAEZ,IAAF,EAAR,CATtB,CADK,CAAP;AAYD,CAfM","file":"imageUpload.js","sourcesContent":["import path from 'path'\r\nimport fs from 'fs'\r\nimport uuid from 'uuid'\r\nimport mkdirp from 'mkdirp'\r\n\r\nconst uploadDir = path.join(__dirname, '../public/images')\r\n\r\n\r\n// Ensure upload directory exists\r\nmkdirp.sync(uploadDir)\r\n\r\nexport const storeFS = ({ stream, filename }) => {\r\n  const id = uuid.v4()\r\n  const path = `${uploadDir}/${id}-${filename}`\r\n  return new Promise((resolve, reject) =>\r\n    stream\r\n      .on('error', error => {\r\n        if (stream.truncated)\r\n          // Delete the truncated file\r\n          fs.unlinkSync(path)\r\n        reject(error)\r\n      })\r\n      .pipe(fs.createWriteStream(path))\r\n      .on('error', error => reject(error))\r\n      .on('finish', () => resolve({ path }))\r\n  )\r\n}\r\n"]}